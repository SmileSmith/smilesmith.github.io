<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Babel、Module、Webpack | 前路漫漫</title>
    <meta name="description" content="前路漫漫 当克己 当慎独">
    
    
    <link rel="preload" href="/assets/css/0.styles.6dd12250.css" as="style"><link rel="preload" href="/assets/js/app.0623bd66.js" as="script"><link rel="preload" href="/assets/js/2.5dd5749f.js" as="script"><link rel="preload" href="/assets/js/21.e7f0e2c3.js" as="script"><link rel="prefetch" href="/assets/js/10.fc6c68bf.js"><link rel="prefetch" href="/assets/js/11.ba650025.js"><link rel="prefetch" href="/assets/js/12.c6bd3826.js"><link rel="prefetch" href="/assets/js/13.65bc4a49.js"><link rel="prefetch" href="/assets/js/14.91612579.js"><link rel="prefetch" href="/assets/js/15.d9728f90.js"><link rel="prefetch" href="/assets/js/16.0cdff337.js"><link rel="prefetch" href="/assets/js/17.9b49432d.js"><link rel="prefetch" href="/assets/js/18.c6c32b37.js"><link rel="prefetch" href="/assets/js/19.d06222f2.js"><link rel="prefetch" href="/assets/js/20.8888a134.js"><link rel="prefetch" href="/assets/js/22.1e32b4b7.js"><link rel="prefetch" href="/assets/js/23.2bdf04ee.js"><link rel="prefetch" href="/assets/js/24.2c3bbe4d.js"><link rel="prefetch" href="/assets/js/25.d1292960.js"><link rel="prefetch" href="/assets/js/26.6cabc15b.js"><link rel="prefetch" href="/assets/js/27.0d0f2ae0.js"><link rel="prefetch" href="/assets/js/28.d8f98424.js"><link rel="prefetch" href="/assets/js/3.1a1f1fe3.js"><link rel="prefetch" href="/assets/js/4.7d273734.js"><link rel="prefetch" href="/assets/js/5.e11c7487.js"><link rel="prefetch" href="/assets/js/6.3195bf77.js"><link rel="prefetch" href="/assets/js/7.c30685e8.js"><link rel="prefetch" href="/assets/js/8.8adcad81.js"><link rel="prefetch" href="/assets/js/9.f7bc9cde.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6dd12250.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/images/logo.png" alt="前路漫漫" class="logo"> <span class="site-name can-hide">前路漫漫</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">所有博客</a></div><div class="nav-item"><a href="http://gofrontend.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  个人网站
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/SmileSmith/Blogs" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">所有博客</a></div><div class="nav-item"><a href="http://gofrontend.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  个人网站
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/SmileSmith/Blogs" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Babel、Module、Webpack</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/201812/Babel&amp;Module&amp;Webpack.html#相关背景" class="sidebar-link">相关背景</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/201812/Babel&amp;Module&amp;Webpack.html#技术分析" class="sidebar-link">技术分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/201812/Babel&amp;Module&amp;Webpack.html#_1-为什么要tree-shaking？" class="sidebar-link">1. 为什么要tree-shaking？</a></li><li class="sidebar-sub-header"><a href="/201812/Babel&amp;Module&amp;Webpack.html#_2-tree-shaking的原理是什么？" class="sidebar-link">2. tree-shaking的原理是什么？</a></li><li class="sidebar-sub-header"><a href="/201812/Babel&amp;Module&amp;Webpack.html#_3-webpack中如何启用tree-shaking？" class="sidebar-link">3. webpack中如何启用tree-shaking？</a></li><li class="sidebar-sub-header"><a href="/201812/Babel&amp;Module&amp;Webpack.html#_4-tree-shaking和babel有什么关系？" class="sidebar-link">4. tree-shaking和babel有什么关系？</a></li><li class="sidebar-sub-header"><a href="/201812/Babel&amp;Module&amp;Webpack.html#_5-如何避免babel把esmodule转成commonjsmodule呢？" class="sidebar-link">5. 如何避免Babel把ESModule转成CommonJSModule呢？</a></li><li class="sidebar-sub-header"><a href="/201812/Babel&amp;Module&amp;Webpack.html#_6-这个问题是什么？" class="sidebar-link">6. 这个问题是什么？</a></li><li class="sidebar-sub-header"><a href="/201812/Babel&amp;Module&amp;Webpack.html#_7-鱼和熊掌可以兼得吗？" class="sidebar-link">7. 鱼和熊掌可以兼得吗？</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="babel、module、webpack"><a href="#babel、module、webpack" class="header-anchor">#</a> Babel、Module、Webpack</h1> <blockquote><p>关键字：tree-shaking webpack babel transform-runtime</p></blockquote> <h2 id="相关背景"><a href="#相关背景" class="header-anchor">#</a> 相关背景</h2> <p>现代化的业务前端项目里现在主流的是在用webpack做构建，但是由于webpack4之前官方文档的不完善，加上相关技术栈的多样，导致webpack配置一直是前端界的一块难啃的鸡肋。</p> <ul><li>项目融资已经到位，就差一名首席Webpack 配置工程师了</li></ul> <p>项目背景如下：</p> <ol><li>有一个webpack构建的项目</li> <li>使用babel做JS代码转译</li> <li>项目中有混用ESModule，CommonJSModule的行为</li> <li>想开启webpack的tree-shaking</li></ol> <h2 id="技术分析"><a href="#技术分析" class="header-anchor">#</a> 技术分析</h2> <h3 id="_1-为什么要tree-shaking？"><a href="#_1-为什么要tree-shaking？" class="header-anchor">#</a> 1. 为什么要tree-shaking？</h3> <p>一是可以减少代码体积，二是为了方便定位问题</p> <h3 id="_2-tree-shaking的原理是什么？"><a href="#_2-tree-shaking的原理是什么？" class="header-anchor">#</a> 2. tree-shaking的原理是什么？</h3> <p>在webpack中，基于ES2015 模块（也叫做 <strong>harmony</strong> 模块）的静态分析能力，也就是说通过静态语法分析，就能找到模块之前的依赖点，进而找出不需要的依赖，在构建阶段就删除不需要的依赖。</p> <blockquote><p>中文文档：<a href="https://webpack.docschina.org/guides/tree-shaking/" target="_blank" rel="noopener noreferrer">https://webpack.docschina.org/guides/tree-shaking/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h3 id="_3-webpack中如何启用tree-shaking？"><a href="#_3-webpack中如何启用tree-shaking？" class="header-anchor">#</a> 3. webpack中如何启用tree-shaking？</h3> <ul><li><p>代码中使用ES2015 模块，在导入时使用按需导入的语法 <code>import { foo, bar } from './ESModule';</code></p></li> <li><p>webpack默认会进行tree-shaking分析，标记未被使用的导出内容为 <strong>unused harmony export</strong>，但是不会删除相关代码</p></li> <li><p>使用uglifyJS等webpack插件会删掉 被webpack标记为 <strong>unused harmony export</strong>的代码</p></li></ul> <blockquote><p>参考例子：<a href="https://github.com/SmileSmith/Daily/tree/master/examples/webpack/20181201" target="_blank" rel="noopener noreferrer">https://github.com/SmileSmith/Daily/tree/master/examples/webpack/20181201<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h3 id="_4-tree-shaking和babel有什么关系？"><a href="#_4-tree-shaking和babel有什么关系？" class="header-anchor">#</a> 4. tree-shaking和babel有什么关系？</h3> <p>babel是个可以配合webpack的编译器，项目中经常用babel-loader来嵌入babel处理代码。重要的是 <strong>babel可能会改变模块类型</strong>，也就是说代码写了import,export语法的ES模块，在Babel处理后会变成CommonJS 的模块。而webapck是无法对动态的CommonJS模块进行语法分析的。</p> <p>：<strong>所以如果Babel把ES模块转成CommonJS模块，tree-shaking会失效。</strong></p> <h3 id="_5-如何避免babel把esmodule转成commonjsmodule呢？"><a href="#_5-如何避免babel把esmodule转成commonjsmodule呢？" class="header-anchor">#</a> 5. 如何避免Babel把ESModule转成CommonJSModule呢？</h3> <p>babel-preset中有一个modules配置，默认是<code>'cjs'</code>，会把ESModule转成CommonJS。如果不想转成Cjs，就配置babel-preset <code>modules: false</code>，以webpack，babelv6，在babel-loader中配置为例：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
            exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
            use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
                loader<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">{</span>
                    presets<span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">[</span>
                            <span class="token string">&quot;env&quot;</span><span class="token punctuation">,</span>
                            <span class="token punctuation">{</span>
                                modules<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 不对module进行转化处理</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token string">&quot;stage-2&quot;</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;transform-runtime&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 问题6</span>
                    cacheDirectory<span class="token operator">:</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><blockquote><p>Babel官方文档：<a href="https://babeljs.io/docs/en/next/babel-preset-env#modules" target="_blank" rel="noopener noreferrer">https://babeljs.io/docs/en/next/babel-preset-env#modules<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h3 id="_6-这个问题是什么？"><a href="#_6-这个问题是什么？" class="header-anchor">#</a> 6. 这个问题是什么？</h3> <p>在说明这个问题之前，前置两个点</p> <ul><li><p>babel-plugin-transform-runtime是个解决babel-polyfill问题的插件，会往需要polyfill的模块中 <strong>导入</strong> polyfill代码。Babel官方文档：<a href="https://babeljs.io/docs/en/next/babel-plugin-transform-runtime" target="_blank" rel="noopener noreferrer">https://babeljs.io/docs/en/next/babel-plugin-transform-runtime<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p>现代JS编译器，对于JS模块的解读，如果代码中出现import或者export，它就被当作ESModule。并且，在ESModule中module.exports是保留字，不允许操作，否则会报如下错误</p></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>Cannot assign to <span class="token builtin class-name">read</span> only property <span class="token string">'exports'</span> of object <span class="token string">'#&lt;Object&gt;'</span>
</code></pre></div><p>一个奇怪的问题来了，当满足以下条件时，会出现transform-runtime往<strong>CommonJS模块中import导入polyfill</strong>的代码导致报错：</p> <ol><li>使用问题5中所示的Babel配置: <code>modules:false &amp;&amp; babel-plugin-transform-runtime</code></li> <li>代码有，在ESModule中导入CommonJSModule的行为`</li> <li>CommonJSModule中有需要polyfill的代码（如直接写Promise）</li></ol> <blockquote><p>参考例子：<a href="https://github.com/SmileSmith/Daily/tree/master/examples/webpack/20181201" target="_blank" rel="noopener noreferrer">https://github.com/SmileSmith/Daily/tree/master/examples/webpack/20181201<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <p>入口模块index中导入CommonJSModule，CommonJSModule中含有原生Promise写法。在Babel处理时，transform
-runtime会往CommonJSModule中import一段polyfill。导致报错。</p> <ul><li><p>如果没有<code>module:false</code>，transform-runtime往CommonJSModule中导入polyfill会使用reqire的方式，不会报错。但是会导致其它ESModule在webpack中的tree-shaking失效😢</p></li> <li><p>如果没有transform-runtime，就不会有有polyfill导入，CommonJSModule原样输出，被webpack当作CommonJS模块，不会报错。但是没有transform-runtime，想使用新的语法就得用全局导入babel-polyfill的方式😢</p></li></ul> <h3 id="_7-鱼和熊掌可以兼得吗？"><a href="#_7-鱼和熊掌可以兼得吗？" class="header-anchor">#</a> 7. 鱼和熊掌可以兼得吗？</h3> <p>可以，在<a href="https://github.com/babel/babel/issues/9238" target="_blank" rel="noopener noreferrer">https://github.com/babel/babel/issues/9238<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中babel说明有一个sourceType选项，可以指定babel对待源文件的方式。对于CommonJS模块，指定为<code>sourceType: 'script'</code>，这样transform-runtime在插入polyfill时就会使用require的方式。😋</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            test<span class="token operator">:</span> <span class="token regex">/CommonJSModule\.js$/</span><span class="token punctuation">,</span>
            exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
            use<span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    loader<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
                    options<span class="token operator">:</span> <span class="token punctuation">{</span>
                        presets<span class="token operator">:</span> <span class="token punctuation">[</span>
                            <span class="token punctuation">[</span>
                                <span class="token string">&quot;env&quot;</span><span class="token punctuation">,</span>
                                <span class="token punctuation">{</span>
                                    modules<span class="token operator">:</span> <span class="token string">&quot;commonjs&quot;</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">]</span><span class="token punctuation">,</span>
                            <span class="token string">&quot;stage-2&quot;</span><span class="token punctuation">,</span>
                        <span class="token punctuation">]</span><span class="token punctuation">,</span>
                        plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;transform-runtime&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        cacheDirectory<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                        <span class="token comment">// CommonJS规范的使用sourceType: &quot;script&quot;</span>
                        sourceType<span class="token operator">:</span> <span class="token string">&quot;script&quot;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            test<span class="token operator">:</span> <span class="token regex">/(ESModule|index)\.js$/</span><span class="token punctuation">,</span>
            exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
            use<span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    loader<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
                    options<span class="token operator">:</span> <span class="token punctuation">{</span>
                        presets<span class="token operator">:</span> <span class="token punctuation">[</span>
                            <span class="token punctuation">[</span>
                                <span class="token string">&quot;env&quot;</span><span class="token punctuation">,</span>
                                <span class="token punctuation">{</span>
                                    modules<span class="token operator">:</span> <span class="token boolean">false</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">]</span><span class="token punctuation">,</span>
                            <span class="token string">&quot;stage-2&quot;</span><span class="token punctuation">,</span>
                        <span class="token punctuation">]</span><span class="token punctuation">,</span>
                        plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;transform-runtime&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        cacheDirectory<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                        <span class="token comment">// ES规范的使用sourceType: &quot;module&quot;（默认值）</span>
                        sourceType<span class="token operator">:</span> <span class="token string">&quot;module&quot;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/SmileSmith/Blogs/edit/master/docs/201812/Babel&amp;Module&amp;Webpack.md" target="_blank" rel="noopener noreferrer">帮助改善此页面！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">最后更新:</span> <span class="time">12/29/2019, 11:32:53 AM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.0623bd66.js" defer></script><script src="/assets/js/2.5dd5749f.js" defer></script><script src="/assets/js/21.e7f0e2c3.js" defer></script>
  </body>
</html>
